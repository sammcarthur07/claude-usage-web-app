<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude PWA Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .fail { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Claude PWA Debug Tool</h1>
    <p>This page tests individual components to identify initialization issues.</p>

    <div id="tests"></div>

    <h2>Manual Tests</h2>
    <button onclick="testGoogleScript()">Test Google Script Loading</button>
    <button onclick="testConfig()">Test Configuration</button>
    <button onclick="testManagers()">Test Manager Creation</button>
    <button onclick="window.location.href='index.html'">Go to Main App</button>

    <h2>Debug Output</h2>
    <pre id="console-output"></pre>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        let logOutput = '';

        function captureLog(...args) {
            logOutput += '[LOG] ' + args.join(' ') + '\n';
            document.getElementById('console-output').textContent = logOutput;
            originalLog.apply(console, args);
        }

        function captureError(...args) {
            logOutput += '[ERROR] ' + args.join(' ') + '\n';
            document.getElementById('console-output').textContent = logOutput;
            originalError.apply(console, args);
        }

        function captureWarn(...args) {
            logOutput += '[WARN] ' + args.join(' ') + '\n';
            document.getElementById('console-output').textContent = logOutput;
            originalWarn.apply(console, args);
        }

        console.log = captureLog;
        console.error = captureError;
        console.warn = captureWarn;

        // Test results
        const tests = [];

        function addTest(name, status, message, details = '') {
            tests.push({ name, status, message, details });
            renderTests();
        }

        function renderTests() {
            const container = document.getElementById('tests');
            container.innerHTML = tests.map(test => `
                <div class="test ${test.status}">
                    <strong>${test.name}</strong>: ${test.message}
                    ${test.details ? `<br><small>${test.details}</small>` : ''}
                </div>
            `).join('');
        }

        // Run basic tests
        function runBasicTests() {
            // Test 1: Check if running on HTTPS (required for many PWA features)
            const isHTTPS = window.location.protocol === 'https:' || window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            addTest('HTTPS Check', isHTTPS ? 'pass' : 'fail', 
                   isHTTPS ? 'Running on secure origin' : 'Not running on HTTPS - some features may fail',
                   `Protocol: ${window.location.protocol}, Host: ${window.location.hostname}`);

            // Test 2: Check script loading
            const scripts = Array.from(document.scripts);
            addTest('Script Tags', 'info', `${scripts.length} scripts loaded`, 
                   scripts.map(s => s.src || 'inline').join(', '));

            // Test 3: Check if config is available
            setTimeout(() => {
                if (typeof GOOGLE_CONFIG !== 'undefined') {
                    addTest('Google Config', 'pass', 'Configuration loaded', 
                           `Client ID: ${GOOGLE_CONFIG.clientId.substring(0, 20)}...`);
                } else {
                    addTest('Google Config', 'fail', 'Configuration not loaded', 
                           'js/config.js may not be loading');
                }
            }, 1000);

            // Test 4: Check Google script
            setTimeout(() => {
                if (window.google && window.google.accounts) {
                    addTest('Google API', 'pass', 'Google Sign-In API loaded');
                } else {
                    addTest('Google API', 'fail', 'Google Sign-In API not available',
                           'Network issue or script blocked');
                }
            }, 3000);
        }

        function testGoogleScript() {
            addTest('Google Script Test', 'info', 'Loading Google script...');
            
            const script = document.createElement('script');
            script.src = 'https://accounts.google.com/gsi/client';
            script.onload = () => {
                addTest('Google Script Load', 'pass', 'Google script loaded successfully');
                setTimeout(() => {
                    if (window.google && window.google.accounts) {
                        addTest('Google API Available', 'pass', 'Google API is accessible');
                    } else {
                        addTest('Google API Available', 'fail', 'Google API not accessible after script load');
                    }
                }, 1000);
            };
            script.onerror = () => {
                addTest('Google Script Load', 'fail', 'Failed to load Google script');
            };
            document.head.appendChild(script);
        }

        function testConfig() {
            try {
                if (typeof GOOGLE_CONFIG === 'undefined') {
                    addTest('Config Test', 'fail', 'GOOGLE_CONFIG not defined');
                    return;
                }
                
                addTest('Config Test', 'pass', 'Configuration accessible');
                addTest('Client ID', GOOGLE_CONFIG.clientId.includes('apps.googleusercontent.com') ? 'pass' : 'fail',
                       GOOGLE_CONFIG.clientId.includes('apps.googleusercontent.com') ? 'Valid Client ID format' : 'Invalid Client ID');
                
            } catch (error) {
                addTest('Config Test', 'fail', 'Error accessing config: ' + error.message);
            }
        }

        function testManagers() {
            const managerTests = [
                'storageManager', 'themeManager', 'chartManager',
                'googleAuthManager', 'manualAuthManager', 'authManager',
                'dataCollector', 'dashboardManager'
            ];
            
            managerTests.forEach(manager => {
                setTimeout(() => {
                    if (window[manager]) {
                        addTest(`${manager}`, 'pass', 'Manager created');
                    } else {
                        addTest(`${manager}`, 'fail', 'Manager not created');
                    }
                }, 2000);
            });
        }

        // Run tests on load
        window.addEventListener('load', () => {
            runBasicTests();
        });
    </script>

    <!-- Load the same scripts as main app -->
    <script src="https://accounts.google.com/gsi/client" onload="window.googleScriptLoaded = true" onerror="window.googleScriptError = true"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/auth/google-auth.js"></script>
    <script src="js/auth/manual-auth.js"></script>
    <script src="js/auth/auth-manager.js"></script>
    <script src="js/data-collector.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>